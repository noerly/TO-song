<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>写给你的信</title>
<style>
/* 保持原有样式不变 */
/* 1. 爱心碎片样式 */
.heart-fragment {
  position: fixed;
  bottom: 100px;
  left: 50%;
  transform: translateX(-50%);
  background: #ff7597;
  border-radius: 50%;
  pointer-events: none;
  animation: fragmentFly linear forwards;
}

@keyframes fragmentFly {
  0% {
    opacity: 1;
    transform: translateX(-50%) translateY(0) scale(1);
  }
  100% {
    opacity: 0;
    transform: 
      translateX(calc(-50% + var(--x-offset, 0px))) 
      translateY(var(--y-offset, -100px)) 
      scale(0.3);
  }
}

/* 2. 星点样式 */
.bg-stars {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
  pointer-events: none;
}

.star {
  position: absolute;
  background: rgba(255, 255, 255, 0.6);
  border-radius: 50%;
  animation: starBlink linear infinite;
}

@keyframes starBlink {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 1; }
}

/* 3. 基础样式 */
body {
  margin: 0;
  background: #0f0f13;
  color: #fff;
  font-family: "Noto Sans SC", "PingFang SC", "Microsoft Yahei", sans-serif;
  min-height: 100vh;
  position: relative;
  overflow: hidden;
}

.container {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
  position: relative;
  transition: transform 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
  z-index: 1;
}

.container.scroll-up {
  transform: translateY(-200vh);
}

#text {
  max-width: 100%;
  font-size: 20px;
  line-height: 1.8;
  white-space: pre-wrap;
  text-align: center;
  border-right: 2px solid #ff7597;
  animation: blink 0.9s step-end infinite;
  min-height: 120px;
  max-height: 70vh;
  overflow-y: auto;
  padding: 20px 10px;
  margin-bottom: 40px;
}

/* 自定义滚动条 */
#text::-webkit-scrollbar {
  width: 6px;
}
#text::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
}
#text::-webkit-scrollbar-thumb {
  background: rgba(255, 117, 151, 0.5);
  border-radius: 10px;
}

@keyframes blink {
  50% { border-color: transparent; }
}

.heart-wrap {
  position: fixed;
  bottom: 60px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  opacity: 0;
  transition: opacity 1s ease;
  z-index: 999;
  pointer-events: none;
}

.heart-wrap.visible {
  pointer-events: auto;
}

.heart {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: linear-gradient(135deg, #ff5f8a, #ff1744);
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 4px 15px rgba(255, 71, 102, 0.4);
  cursor: pointer;
  transform: scale(1);
  animation: pulse 2s infinite;
  position: relative;
  user-select: none;
  touch-action: manipulation;
}

.heart svg {
  width: 40px;
  height: 40px;
}

@keyframes pulse {
  0%,100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

.final-msg {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  color: #ffbfcf;
  font-size: 28px;
  text-align: center;
  opacity: 0;
  transition: all 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);
  z-index: 5;
  max-width: 90%;
  padding: 20px;
  text-shadow: 0 0 15px rgba(255, 117, 151, 0.8);
  animation: heartBeat 1.5s ease-in-out infinite;
  animation-play-state: paused;
}

.final-msg.show {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
  animation-play-state: running;
}

@keyframes heartBeat {
  0%, 100% { transform: translate(-50%, -50%) scale(1); }
  15% { transform: translate(-50%, -50%) scale(1.05); }
  30% { transform: translate(-50%, -50%) scale(1); }
  45% { transform: translate(-50%, -50%) scale(1.05); }
  60% { transform: translate(-50%, -50%) scale(1); }
}

/* 爱心扩散效果 */
.heart-particles {
  position: fixed;
  bottom: 60px;
  left: 50%;
  transform: translateX(-50%);
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: rgba(255, 117, 151, 0.8);
  z-index: 998;
  opacity: 0;
}

.heart-particles.animate {
  animation: heartExplode 1.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

@keyframes heartExplode {
  0% {
    transform: translateX(-50%) scale(1);
    opacity: 1;
    box-shadow: 0 0 20px rgba(255, 117, 151, 0.8);
  }
  70% {
    transform: translateX(-50%) scale(5);
    opacity: 0.6;
    box-shadow: 0 0 60px rgba(255, 117, 151, 0.5);
  }
  100% {
    transform: translateX(-50%) scale(6);
    opacity: 0;
    box-shadow: 0 0 100px rgba(255, 117, 151, 0);
  }
}

@media (max-width: 600px) {
  #text {
    font-size: 18px;
    line-height: 1.6;
  }
  .final-msg {
    font-size: 22px;
  }
  .heart {
    width: 60px;
    height: 60px;
  }
  .heart svg {
    width: 30px;
    height: 30px;
  }
}
</style>
</head>
<body>
<!-- 星点容器 -->
<div class="bg-stars" id="bgStars"></div>

<div class="container" id="container">
  <div id="text"></div>
</div>

<!-- 爱心扩散粒子 -->
<div class="heart-particles" id="heartParticles"></div>

<!-- 最终表白文字 -->
<div class="final-msg" id="finalMsg">❤ 我喜欢你，从认识你的那一刻开始。当你看到这个的时候就代表你同意了 ！❤ </div>

<!-- 爱心按钮 -->
<div class="heart-wrap" id="heartWrap">
  <div class="heart" id="heartBtn">
    <svg viewBox="0 0 24 24" fill="#fff">
      <path d="M12 20s-7.5-4.9-9.3-7.2c-1.8-2.3-.3-5.8 2.4-6.1 1.8-.2 3.1 1 3.7 1.7.6.7 1.4 1.6 2.9 1.6s2.3-.9 2.9-1.6c.6-.7 1.9-1.9 3.7-1.7 2.7.3 4.2 3.8 2.4 6.1C19.5 15.1 12 20 12 20z"/>
    </svg>
  </div>
</div>

<!-- 音乐播放器 -->
<audio id="backgroundMusic" loop preload="auto" autoplay>
  <source src="My Soul.mp3" type="audio/mpeg">
  你的浏览器不支持音频播放
</audio>

<script>
// 信件内容
const message = `
亲爱的菘菘：

爱上一个人，有时候只需要几秒钟的心动，
有时候却要几个月，甚至几年的相处。
可我想来，几个月太久了，
久到我害怕你突然就不联系我了
久到你突然就讨厌我了，
久到我还没有说出那句：“我爱你”你就已经开始讨厌我了.
我这一生因为畏缩错过了很多
错过了很多机会，
但这次，我不想错过了。
我不会什么特别的表白方式，
只能通过自己会的一切，
来表达我的情感。

也许是你某些不经意的举动，
让我有了“好像喜欢上了”的错觉。
可每次冷静下来，
我还是会打开我们的聊天窗口，
我还是会情不自禁的去想你，
想听到你的声音，想和你聊天，
我也不知道我怎么了，
但是这是我第一次无法抑制住自己的感情。
于是我做出了那种令你不舒服的事情：
总是给你发你在干什么
总是在你忙的时候也是焦急的等待你的回信，
后面我想了一下，
我想我是爱上了你。

也许你会嫌我笨拙，或者太急，
但喜欢一个人，本来就像一场豪赌。
而我也很庆幸——
在 2025 年 10 月 3 日晚上 18 点 03 分，遇见了你。
`;

// 元素获取
const textEl = document.getElementById('text');
const heartWrap = document.getElementById('heartWrap');
const heartBtn = document.getElementById('heartBtn');
const finalMsg = document.getElementById('finalMsg');
const container = document.getElementById('container');
const heartParticles = document.getElementById('heartParticles');
const bgStars = document.getElementById('bgStars');
const backgroundMusic = document.getElementById('backgroundMusic');

// 打字速度控制（数值越小越快）
const baseSpeed = 45; // 基础速度，可调整

// 优化的打字动画函数
function typeWriter() {
  let i = 0;
  const startTime = performance.now(); // 使用高精度时间
  
  // 使用requestAnimationFrame优化动画流畅度
  function writeNextChar(timestamp) {
    if (i >= message.length) {
      // 打字完成
      textEl.style.borderRight = "none";
      heartWrap.style.opacity = 1;
      setTimeout(() => heartWrap.classList.add('visible'), 1000);
      return;
    }
    
    // 计算当前应该显示到哪个字符
    const elapsed = timestamp - startTime;
    const char = message.charAt(i);
    
    // 根据字符类型计算延迟
    let delay = baseSpeed;
    if (char === '，' || char === '。' || char === '\n') {
      delay = baseSpeed * 3;
    } else if (char === '！' || char === '？') {
      delay = baseSpeed * 4;
    }
    
    // 添加字符
    textEl.textContent += char;
    i++;
    
    // 只在内容超过可视区域时才滚动，减少DOM操作
    if (textEl.scrollHeight > textEl.clientHeight) {
      textEl.scrollTop = textEl.scrollHeight;
    }
    
    // 安排下一帧
    setTimeout(() => {
      requestAnimationFrame(writeNextChar);
    }, delay);
  }
  
  // 启动动画
  requestAnimationFrame(writeNextChar);
}

// 其他函数保持不变
function createStars() {
  const starCount = 50;
  for (let i = 0; i < starCount; i++) {
    const star = document.createElement('div');
    star.classList.add('star');
    star.style.left = `${Math.random() * 100}vw`;
    star.style.top = `${Math.random() * 100}vh`;
    star.style.width = star.style.height = `${Math.random() * 2 + 1}px`;
    star.style.animationDuration = `${Math.random() * 3 + 2}s`;
    star.style.animationDelay = `${Math.random() * 5}s`;
    bgStars.appendChild(star);
  }
}

function createHeartFragments() {
  const fragmentCount = 15;
  for (let i = 0; i < fragmentCount; i++) {
    const fragment = document.createElement('div');
    fragment.classList.add('heart-fragment');
    const size = Math.random() * 6 + 3;
    fragment.style.width = fragment.style.height = `${size}px`;
    fragment.style.setProperty('--x-offset', `${Math.random() * 120 - 60}px`);
    fragment.style.setProperty('--y-offset', `${-Math.random() * 150 - 50}px`);
    fragment.style.animationDuration = `${Math.random() * 1.5 + 0.8}s`;
    document.body.appendChild(fragment);
    setTimeout(() => fragment.remove(), 2300);
  }
}

function handleHeartClick(e) {
  e.stopPropagation();
  createHeartFragments();
  heartWrap.style.opacity = 0;
  heartWrap.classList.remove('visible');
  heartParticles.classList.add('animate');
  setTimeout(() => container.classList.add('scroll-up'), 300);
  setTimeout(() => finalMsg.classList.add('show'), 800);
}

function playMusic() {
  backgroundMusic.play().catch(err => {
    console.log('自动播放失败，等待用户交互:', err);
    function handleUserInteraction() {
      backgroundMusic.play().then(() => {
        document.removeEventListener('click', handleUserInteraction);
        document.removeEventListener('touchstart', handleUserInteraction);
      });
    }
    document.addEventListener('click', handleUserInteraction);
    document.addEventListener('touchstart', handleUserInteraction);
  });
}

// DOM加载完成后初始化
document.addEventListener('DOMContentLoaded', function() {
  createStars();    // 生成星点
  typeWriter();     // 开始打字动画
  playMusic();      // 尝试播放音乐
  
  // 绑定事件
  heartBtn.addEventListener('click', handleHeartClick);
  heartBtn.addEventListener('touchstart', function(e) {
    e.preventDefault();
    handleHeartClick(e);
  });
});
</script>
</body>
</html>
